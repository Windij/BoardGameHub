{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Левая часть с информацией о встрече -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h3>{{ session.game.title }}</h3>
                </div>
                <div class="card-body">
                    <p><strong>Дата:</strong> {{ session.date.strftime('%d.%m.%Y') }}</p>
                    <p><strong>Время:</strong> {{ session.time.strftime('%H:%M') }}</p>
                    <p><strong>Место:</strong> {{ session.location }}</p>
                    <p><strong>Организатор:</strong> {{ session.creator.name }}</p>
                    <p><strong>Участники:</strong> {{ session.current_players }}/{{ session.max_players }}</p>
                    <p><strong>Описание:</strong></p>
                    <p>{{ session.description }}</p>

                    <div class="mt-3">
                        {% if current_user.is_authenticated %}
                            {% if current_user in session.participants %}
                                <form action="{{ url_for('game_sessions_leave', id=session.id) }}" method="post">
                                    <button type="submit" class="btn btn-danger">Покинуть встречу</button>
                                </form>
                            {% elif session.current_players < session.max_players %}
                                <form action="{{ url_for('game_sessions_join', id=session.id) }}" method="post">
                                    <button type="submit" class="btn btn-success">Присоединиться</button>
                                </form>
                            {% else %}
                                <button class="btn btn-secondary" disabled>Все места заняты</button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Правая часть с картой -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h4>Место встречи на карте</h4>
                </div>
                <div class="card-body p-0">
                    <div id="map" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Яндекс.Карты API -->
<script src="https://api-maps.yandex.ru/2.1/?apikey=f3a0fe3a-b07e-4840-a1da-06f18b2ddf13&lang=ru_RU"></script>
<script>
    ymaps.ready(init);

    function init() {
        const map = new ymaps.Map("map", {
            center: [{{ map_coordinates.latitude }}, {{ map_coordinates.longitude }}],
            zoom: {{ map_coordinates.zoom }},
            controls: ['zoomControl', 'typeSelector']
        });

        // Добавляем метку
        const placemark = new ymaps.Placemark([{{ map_coordinates.latitude }}, {{ map_coordinates.longitude }}], {
            hintContent: '{{ session.location }}',
            balloonContent: 'Место встречи'
        });

        map.geoObjects.add(placemark);
    }
</script>
{% endblock %}